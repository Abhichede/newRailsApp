<%- model_class = Site -%>
<div class="page-header">
  <div class="row">
    <div class="col-md-6">
      <div class="col-md-2">
        <%= link_to sites_path do %>
            <i class="glyphicon glyphicon-arrow-left btn btn-warning btn-sm"></i>
        <% end %>
      </div>
      <div class="col-md-6">
        <h4><strong><%= @site.name.upcase %></strong></h4>
        <h4>
          <div class="label label-success">
                Available Flats
          </div>
          <span class="label label-danger"><%= "#{@site.no_of_units - @site.flats.where(:booking_status=>1).count}" %></span>
        </h4>
      </div>
    </div>
    <div class="col-md-6">
        <div class="col-md-4 col-sm-4 col-xs-4">
          <% if @site.flats.count != @site.no_of_units %>
              <%= link_to 'Add Flat', {:controller => "flats", :action => "new", :site_id => @site.id }, :class => 'btn btn-success btn-sm' %>
          <% end %>
        </div>
        <div class="col-md-4 col-sm-4 col-xs-4">
          <%= link_to 'Edit Site',
                      edit_site_path(@site), :class => 'btn btn-info btn-sm' %>
        </div>
        <div class="col-md-4 col-sm-4 col-xs-4">
          <% link_to 'delete site',
                      site_path(@site),
                      :method => 'delete',
                      :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
                      :class => 'btn btn-danger btn-sm' %>
        </div>
    </div>
  </div>
</div>
<div class="row">
  <div class="col-md-6">
  <dl class="dl-horizontal">
    <dt><strong><%= model_class.human_attribute_name(:address) %>:</strong></dt>
    <dd><%= @site.address %></dd>
    <dt><strong><%= model_class.human_attribute_name(:no_of_units) %>:</strong></dt>
    <dd><%= @site.no_of_units %></dd>
    <dt><strong><%= model_class.human_attribute_name(:type_of_structures) %>:</strong></dt>
    <dd><%= @site.type_of_structures %></dd>
    <dt><strong><%= model_class.human_attribute_name(:site_type) %>:</strong></dt>
    <dd><%= @site.site_type %></dd>
    <dt><strong><%= model_class.human_attribute_name(:area_of_plot) %>:</strong></dt>
    <dd><%= @site.area_of_plot %></dd>
    <dt><strong><%= model_class.human_attribute_name(:project_approved_by) %>:</strong></dt>
    <dd><%= @site.project_approved_by %></dd>
  </dl>
  </div>
  <div class="col-md-6 outstanding-table">
    <table class="table table-stripped">
      <thead>
        <tr>
          <th>Customer Name (Flat No.)</th>
          <th>Total Amount</th>
          <th>Received Amount</th>
          <th>Outstanding amount</th>
        </tr>
      </thead>
      <tbody>
      <% total_amount = 0
         total_paid = 0 %>
        <% @site.booking_details.each do |booking| %>
          <tr>
            <td><%= link_to booking.customer_name, booking_detail_path(booking) %> (<%= booking.flat.flat_number %>)</td>
            <td>&#8377; <%= booking.final_sale_deed %></td>
              <% total_amount = total_amount + booking.final_sale_deed.to_i %>
            <td>&#8377; <%= booking.paid_amount %></td>
              <% total_paid = total_paid + booking.paid_amount.to_i %>
            <td>&#8377; <%= booking.final_sale_deed.to_i - booking.paid_amount.to_i %></td>
          </tr>
        <% end %>
      <tr >
        <td><strong>Totals</strong></td>
        <td><strong>&#8377; <%= total_amount %></strong></td>
        <td><strong>&#8377; <%= total_paid %></strong></td>
        <td><strong>&#8377; <%= total_amount - total_paid %></strong></td>
      </tr>
      </tbody>
    </table>
  </div>
</div>
<hr/>
<ul  class="nav nav-pills">
  <li class="active">
    <a  href="#1a" data-toggle="tab">Flats</a>
  </li>
  <li><a href="#2a" data-toggle="tab">Material</a>
  </li>
  <li><a href="#3a" data-toggle="tab">Suppliers</a>
  </li>

</ul>
<div class="tab-content clearfix">
  <div class="jumbotron tab-pane active" id="1a" style="margin-top: 0.5em">
    <h4 class="text-center">All Flats</h4>
    <hr />
    <div class="row col-md-offset-2 col-sm-offset-1 col-xs-offset-1">
      <% if @site.flats.count == 0 %>
          <h5><strong>No flats added, Click 'ADD FLAT' above to add flats</strong></h5>
      <% else %>
          <% @site.flats.each do |flat| %>
              <%= link_to flat_path(flat) do %>
                <div class="well col-md-3 col-lg-3 col-sm-5 col-xs-5 text-center flats-well" style="margin: 0.5rem;">
                  <%= flat.flat_number %>
                  <% if flat.booking_status %>
                    <span class="label label-danger pull-right">Booked</span>
                  <% else %>
                      <span class="label label-primary pull-right">Available</span>
                  <% end %>
                </div>
              <% end %>
          <% end %>
      <% end %>
    </div>
  </div>
  <div class="jumbotron tab-pane" id="2a" style="margin-top: 0.5em">
    <h4 class="">Material
      <span class="pull-right">
        <%= link_to new_material_path,class: 'btn btn-default btn-sm' do %>
          <i class="fa fa-plus"></i>
        <% end %>
      </span>
    </h4>
    <hr />
    <div class="row">
      <% total_material_amount = 0
         if @site.materials.count != 0
           @site.materials.all.each do |material|
             total_material_amount += material.amount.to_i
           end
         end
      %>
      <div class="col-md-6 pull-right col-md-offset-6">
        <strong>
          Total Material Amount: &#8377; <%= total_material_amount %>
        </strong>
      </div>
    </div>
    <div class="row col-md-offset-2 col-sm-offset-1 col-xs-offset-1">
      <% if @site.materials.count == 0 %>
          <h5><strong>No Material For This Site</strong></h5>
      <% else %>
          <% MaterialList.all.each do |material| %>
              <%= link_to material.material_name, {controller: 'sites', action: 'show_site_material', :id => @site,
                           :type_of_material=>material.material_name},
                          class: 'well col-md-3 col-lg-3 col-sm-10 col-xs-10 text-center flats-well',
                          style: 'margin: 1rem; background-color: #006352; color: #FFF !important;' %>
          <% end %>
      <% end %>
    </div>
  </div>
  <div class="jumbotron tab-pane" id="3a" style="margin-top: 0.5em">
    <h4 class="text-center">Suppliers</h4>
    <hr />
    <div class="row col-md-offset-2 col-sm-offset-1 col-xs-offset-1">
      <% if Supplier.all.count == 0 %>
          <h5><strong>No Material For This Site</strong></h5>
      <% else %>
          <% Supplier.all.each do |supplier| %>
              <% if supplier.deleting_status === 'false' || supplier.deleting_status.blank? %>
                <%= link_to supplier.name, {controller: 'sites', action: 'show_supplier_wise_material', :id => @site,
                                                     :supplier=>supplier.id},
                            class: 'well col-md-3 col-lg-3 col-sm-10 col-xs-10 text-center flats-well',
                            style: 'margin: 1rem; background-color: #006352; color: #FFF !important;' %>
                <% end %>
            <% end %>
      <% end %>
    </div>
  </div>
</div>
